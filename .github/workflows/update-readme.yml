name: Update README when ai.txt changes

on:
  push:
    branches:
      - main
    paths:
      - ai.txt

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Read ai.txt
        id: readfile
        run: |
          CONTENT=$(cat ai.txt | sed 's/`/\\`/g')
          echo "content<<EOF" >> $GITHUB_OUTPUT
          echo "$CONTENT" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Update README.md
        run: |
          # Ø­Ø°Ù Ù†Ø³Ø®Ù‡ Ù‚Ø¨Ù„ÛŒ Ø¨ÛŒÙ† Ù…Ø§Ø±Ú©Ø±Ù‡Ø§
          sed -i '/<!-- AI-TEXT-START -->/,/<!-- AI-TEXT-END -->/d' README.md

          # Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ø¬Ø¯ÛŒØ¯
          cat <<EOF >> README.md

<!-- AI-TEXT-START -->
## ğŸ¤– Ù…Ø­ØªÙˆØ§ÛŒ ÙØ§ÛŒÙ„ ai.txt

\`\`\`
${{ steps.readfile.outputs.content }}
\`\`\`
<!-- AI-TEXT-END -->
EOF

      - name: Commit and push changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          # Ø§Ú¯Ø± ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¨ÙˆØ¯ØŒ commit Ù†Ú©Ù†
          if git diff --quiet; then
            echo "No changes to commit"
            exit 0
          fi

          git add README.md
          git commit -m "Auto update README from ai.txt"
          git push
